<!DOCTYPE html>
<html lang = "ja">
<head>
    <meta charset = "utf-8">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
</head>
<body>
    <center>
    <h1>コメント投稿</h1>
    <div id="map" style="width:400px; height:300px"></div>
    lat: <span id="lat"></span><br>
    lng: <span id="lng"></span><br>
    
    
        <input id=comment>
        <button id=btn class="ui button">投稿</button>
        <div id =divname></div>
    </center>

    <script>
        let lat;
        let lng;

        function initMap() {
            let map = new google.maps.Map(document.getElementById("map"), {
                zoom : 15,
                center : {lat: 36.38992, lng: 139.06065}
            });

            // クリックイベントを追加
            map.addListener('click', function(e) {
                getClickLatLng(e.latLng, map);
            });
        }

        function getClickLatLng(lat_lng, map) {

            lat = lat_lng.lat();
            lng = lat_lng.lng();

            // 座標を表示
            document.getElementById('lat').textContent = lat;
            document.getElementById('lng').textContent = lng;

            // マーカーを設置
            new google.maps.Marker({
                position: lat_lng,
                map: map
            });

            // 座標の中心をずらす
            // http://syncer.jp/google-maps-javascript-api-matome/map/method/panTo/
            map.panTo(lat_lng);
        }
    </script>
    <script type="module">
        import { fetchJSON } from "https://js.sabae.cc/fetchJSON.js";
        btn.onclick = async () => {
            if (lat && lng) {
                const data = await fetchJSON("api/comment/post", {
                    x: String(lat),
                    y: String(lng),
                    data: {comment: comment.value}
                });
            } else {
                alert("スポットを選択してください");
            }
        };
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAu8WH_gESz6U50rwSe7x4AyUDmJiDF9nk&callback=initMap"></script>
</body>
</html>